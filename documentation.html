<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VDK Bank CSV Converter â€” Arc42 Documentation</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
    color: #24292e;
    background: #fff;
    line-height: 1.6;
    display: flex;
    min-height: 100vh;
  }

  nav.sidebar {
    width: 280px;
    min-width: 280px;
    background: #f6f8fa;
    border-right: 1px solid #e1e4e8;
    padding: 24px 16px;
    position: sticky;
    top: 0;
    height: 100vh;
    overflow-y: auto;
  }

  nav.sidebar h2 {
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #6a737d;
    margin-bottom: 16px;
  }

  nav.sidebar a {
    display: block;
    padding: 6px 12px;
    margin-bottom: 2px;
    color: #24292e;
    text-decoration: none;
    font-size: 14px;
    border-radius: 4px;
  }

  nav.sidebar a:hover { background: #e1e4e8; }

  nav.sidebar .section-num {
    display: inline-block;
    width: 28px;
    color: #6a737d;
    font-size: 12px;
  }

  main {
    flex: 1;
    max-width: 860px;
    padding: 40px 48px;
  }

  h1 { font-size: 28px; margin-bottom: 8px; }
  h2 { font-size: 22px; margin-top: 48px; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 1px solid #e1e4e8; }
  h3 { font-size: 17px; margin-top: 28px; margin-bottom: 10px; }

  p { margin-bottom: 12px; }
  ul, ol { margin-bottom: 12px; padding-left: 24px; }
  li { margin-bottom: 4px; }

  code {
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 13px;
    background: #f6f8fa;
    padding: 2px 6px;
    border-radius: 3px;
  }

  pre {
    background: #f6f8fa;
    border: 1px solid #e1e4e8;
    border-radius: 6px;
    padding: 16px;
    overflow-x: auto;
    margin-bottom: 16px;
  }

  pre code { background: none; padding: 0; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 16px;
    font-size: 14px;
  }

  th, td {
    text-align: left;
    padding: 8px 12px;
    border: 1px solid #e1e4e8;
  }

  th { background: #f6f8fa; font-weight: 600; }

  footer {
    margin-top: 64px;
    padding-top: 16px;
    border-top: 1px solid #e1e4e8;
    font-size: 12px;
    color: #6a737d;
  }

  @media (max-width: 768px) {
    body { flex-direction: column; }
    nav.sidebar {
      width: 100%;
      min-width: unset;
      height: auto;
      position: static;
      border-right: none;
      border-bottom: 1px solid #e1e4e8;
    }
    main { padding: 24px 16px; }
  }
</style>
</head>
<body>

<nav class="sidebar">
  <h2>Arc42</h2>
  <a href="#s1"><span class="section-num">1.</span> Introduction and Goals</a>
  <a href="#s2"><span class="section-num">2.</span> Architecture Constraints</a>
  <a href="#s3"><span class="section-num">3.</span> Context and Scope</a>
  <a href="#s4"><span class="section-num">4.</span> Solution Strategy</a>
  <a href="#s5"><span class="section-num">5.</span> Building Block View</a>
  <a href="#s6"><span class="section-num">6.</span> Runtime View</a>
  <a href="#s7"><span class="section-num">7.</span> Deployment View</a>
  <a href="#s8"><span class="section-num">8.</span> Cross-cutting Concepts</a>
  <a href="#s9"><span class="section-num">9.</span> Architecture Decisions</a>
  <a href="#s10"><span class="section-num">10.</span> Quality Requirements</a>
  <a href="#s11"><span class="section-num">11.</span> Risks and Technical Debts</a>
  <a href="#s12"><span class="section-num">12.</span> Glossary</a>
</nav>

<main>

<h1>VDK Bank CSV Converter</h1>
<p>Version 1.0.0 &mdash; Arc42 Architecture Documentation</p>

<!-- ========== 1. INTRODUCTION AND GOALS ========== -->
<h2 id="s1">1. Introduction and Goals</h2>

<h3>Requirements Overview</h3>
<p>VDK Bank CSV Converter reads CSV statement exports from VDK (a Belgian bank) and produces a reformatted CSV compatible with budgeting tools such as YNAB. It splits each transaction's single amount into separate inflow and outflow columns, converts Dutch-format numbers to standard decimals, and maps raw transaction memos to human-readable payee names using a configurable YAML ruleset.</p>

<ul>
  <li>Parse VDK bank CSV exports (semicolon-delimited, <code>windows-1252</code> encoded, 14-line metadata header).</li>
  <li>Convert Dutch number formatting (<code>1.234,56</code>) to standard <code>Decimal</code> values.</li>
  <li>Split a single amount into separate inflow and outflow columns.</li>
  <li>Map transactions without a payee to a known payee name based on configurable memo patterns.</li>
  <li>Write a converted CSV with columns: <code>Date</code>, <code>Payee</code>, <code>Memo</code>, <code>Inflow</code>, <code>Outflow</code>.</li>
</ul>

<h3>Quality Goals</h3>
<table>
  <thead><tr><th>Priority</th><th>Goal</th><th>Description</th></tr></thead>
  <tbody>
    <tr><td>1</td><td>Correctness</td><td>Amounts are converted without floating-point loss (<code>Decimal</code> arithmetic).</td></tr>
    <tr><td>2</td><td>Usability</td><td>Single command converts a file with sensible defaults.</td></tr>
    <tr><td>3</td><td>Extensibility</td><td>New payee mappings are added via YAML config, not code changes.</td></tr>
  </tbody>
</table>

<h3>Stakeholders</h3>
<table>
  <thead><tr><th>Role</th><th>Expectations</th></tr></thead>
  <tbody>
    <tr><td>End user (bank customer)</td><td>Runs the CLI to convert a downloaded VDK CSV into a format their budgeting tool accepts. Expects no data loss and correct payee assignment.</td></tr>
  </tbody>
</table>

<!-- ========== 2. ARCHITECTURE CONSTRAINTS ========== -->
<h2 id="s2">2. Architecture Constraints</h2>

<table>
  <thead><tr><th>Type</th><th>Constraint</th></tr></thead>
  <tbody>
    <tr><td>Technical</td><td>Input files use <code>windows-1252</code> encoding (set by VDK bank).</td></tr>
    <tr><td>Technical</td><td>Input CSV uses semicolon delimiters and Dutch column names (<code>Uitvoeringsdatum</code>, <code>Tegenpartijnaam</code>, <code>Mededeling</code>, <code>Bedrag</code>).</td></tr>
    <tr><td>Technical</td><td>The first 14 lines of every VDK export are bank metadata and are skipped.</td></tr>
    <tr><td>Convention</td><td>Output amounts use comma as decimal separator to match the regional format.</td></tr>
    <tr><td>Dependency</td><td>Requires <code>pyyaml</code>. All other dependencies are Python standard library.</td></tr>
  </tbody>
</table>

<!-- ========== 3. CONTEXT AND SCOPE ========== -->
<h2 id="s3">3. Context and Scope</h2>

<h3>Business Context</h3>

<p>The user downloads a CSV statement from VDK online banking, runs the converter, and imports the result into a budgeting tool.</p>

<svg viewBox="0 0 720 320" xmlns="http://www.w3.org/2000/svg" style="max-width:720px;width:100%;margin-bottom:24px;">
  <!-- C4 Level 1: System Context -->
  <rect x="280" y="10" width="160" height="60" rx="30" fill="#08427b" />
  <text x="360" y="38" text-anchor="middle" fill="#fff" font-family="sans-serif" font-size="13" font-weight="bold">User</text>
  <text x="360" y="55" text-anchor="middle" fill="#cce0ff" font-family="sans-serif" font-size="11">[Person]</text>

  <rect x="240" y="130" width="240" height="70" rx="6" fill="#1168bd" />
  <text x="360" y="158" text-anchor="middle" fill="#fff" font-family="sans-serif" font-size="13" font-weight="bold">VDK CSV Converter</text>
  <text x="360" y="175" text-anchor="middle" fill="#cce0ff" font-family="sans-serif" font-size="11">[Python CLI Application]</text>
  <text x="360" y="190" text-anchor="middle" fill="#cce0ff" font-family="sans-serif" font-size="10">Converts bank CSV to budgeting format</text>

  <rect x="20" y="245" width="200" height="60" rx="6" fill="#999" />
  <text x="120" y="272" text-anchor="middle" fill="#fff" font-family="sans-serif" font-size="13" font-weight="bold">VDK Bank Export</text>
  <text x="120" y="289" text-anchor="middle" fill="#eee" font-family="sans-serif" font-size="11">[CSV File, windows-1252]</text>

  <rect x="500" y="245" width="200" height="60" rx="6" fill="#999" />
  <text x="600" y="272" text-anchor="middle" fill="#fff" font-family="sans-serif" font-size="13" font-weight="bold">Budgeting Tool</text>
  <text x="600" y="289" text-anchor="middle" fill="#eee" font-family="sans-serif" font-size="11">[e.g. YNAB]</text>

  <line x1="360" y1="70" x2="360" y2="130" stroke="#555" stroke-width="1.5" marker-end="url(#a1)" />
  <text x="370" y="105" font-family="sans-serif" font-size="10" fill="#555">Runs CLI</text>

  <line x1="120" y1="245" x2="280" y2="200" stroke="#555" stroke-width="1.5" marker-end="url(#a1)" />
  <text x="160" y="218" font-family="sans-serif" font-size="10" fill="#555">Reads</text>

  <line x1="440" y1="200" x2="580" y2="245" stroke="#555" stroke-width="1.5" marker-end="url(#a1)" />
  <text x="520" y="218" font-family="sans-serif" font-size="10" fill="#555">Produces CSV for</text>

  <defs><marker id="a1" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#555" /></marker></defs>
</svg>

<h3>Technical Context</h3>

<table>
  <thead><tr><th>Interface</th><th>Direction</th><th>Channel / Format</th></tr></thead>
  <tbody>
    <tr><td>VDK bank CSV export</td><td>Input</td><td>Local file. Semicolon-delimited CSV, <code>windows-1252</code> encoding, 14-line header, Dutch column names.</td></tr>
    <tr><td>Converted CSV</td><td>Output</td><td>Local file. Semicolon-delimited CSV, UTF-8, columns: Date, Payee, Memo, Inflow, Outflow.</td></tr>
    <tr><td>Payee config</td><td>Input</td><td>Local YAML file with a <code>payees</code> list of pattern/name entries.</td></tr>
  </tbody>
</table>

<!-- ========== 4. SOLUTION STRATEGY ========== -->
<h2 id="s4">4. Solution Strategy</h2>

<table>
  <thead><tr><th>Decision</th><th>Rationale</th></tr></thead>
  <tbody>
    <tr><td>Sequential read &rarr; transform &rarr; write pipeline</td><td>Bank exports are small files (hundreds of rows). A single-pass pipeline keeps the code straightforward.</td></tr>
    <tr><td><code>Decimal</code> for all monetary values</td><td>Avoids floating-point rounding errors that <code>float</code> introduces with currency.</td></tr>
    <tr><td>YAML-based payee mapping</td><td>Allows users to add new payee rules without modifying code. Pattern matching uses simple substring search.</td></tr>
    <tr><td>CLI with <code>argparse</code></td><td>No web UI or GUI needed. A CLI with sensible defaults minimizes friction.</td></tr>
  </tbody>
</table>

<!-- ========== 5. BUILDING BLOCK VIEW ========== -->
<h2 id="s5">5. Building Block View</h2>

<h3>Whitebox Overall System</h3>

<svg viewBox="0 0 720 420" xmlns="http://www.w3.org/2000/svg" style="max-width:720px;width:100%;margin-bottom:24px;">
  <!-- C4 Level 2: Container / Component -->
  <rect x="10" y="10" width="700" height="400" rx="8" fill="none" stroke="#1168bd" stroke-width="2" stroke-dasharray="8,4" />
  <text x="24" y="34" font-family="sans-serif" font-size="13" fill="#1168bd" font-weight="bold">VDK CSV Converter [Python Package]</text>

  <rect x="270" y="55" width="180" height="65" rx="6" fill="#1168bd" />
  <text x="360" y="80" text-anchor="middle" fill="#fff" font-family="sans-serif" font-size="12" font-weight="bold">cli.py</text>
  <text x="360" y="96" text-anchor="middle" fill="#cce0ff" font-family="sans-serif" font-size="10">[Entry Point]</text>
  <text x="360" y="110" text-anchor="middle" fill="#cce0ff" font-family="sans-serif" font-size="10">Parses args, invokes converter</text>

  <rect x="220" y="175" width="280" height="65" rx="6" fill="#1168bd" />
  <text x="360" y="200" text-anchor="middle" fill="#fff" font-family="sans-serif" font-size="12" font-weight="bold">converter.py &mdash; VdkConverter</text>
  <text x="360" y="216" text-anchor="middle" fill="#cce0ff" font-family="sans-serif" font-size="10">[Core Component]</text>
  <text x="360" y="230" text-anchor="middle" fill="#cce0ff" font-family="sans-serif" font-size="10">Read &rarr; Map &rarr; Write pipeline</text>

  <rect x="40" y="305" width="200" height="65" rx="6" fill="#1168bd" />
  <text x="140" y="330" text-anchor="middle" fill="#fff" font-family="sans-serif" font-size="12" font-weight="bold">models.py &mdash; VdkTransaction</text>
  <text x="140" y="346" text-anchor="middle" fill="#cce0ff" font-family="sans-serif" font-size="10">[Data Model]</text>
  <text x="140" y="360" text-anchor="middle" fill="#cce0ff" font-family="sans-serif" font-size="10">Dataclass with inflow/outflow split</text>

  <rect x="290" y="305" width="200" height="65" rx="6" fill="#1168bd" />
  <text x="390" y="330" text-anchor="middle" fill="#fff" font-family="sans-serif" font-size="12" font-weight="bold">payee_mapper.py</text>
  <text x="390" y="346" text-anchor="middle" fill="#cce0ff" font-family="sans-serif" font-size="10">[Component]</text>
  <text x="390" y="360" text-anchor="middle" fill="#cce0ff" font-family="sans-serif" font-size="10">Pattern-based payee resolution</text>

  <rect x="540" y="305" width="150" height="65" rx="6" fill="#999" />
  <text x="615" y="330" text-anchor="middle" fill="#fff" font-family="sans-serif" font-size="12" font-weight="bold">payees.yaml</text>
  <text x="615" y="346" text-anchor="middle" fill="#eee" font-family="sans-serif" font-size="10">[Config File]</text>
  <text x="615" y="360" text-anchor="middle" fill="#eee" font-family="sans-serif" font-size="10">Payee mapping rules</text>

  <line x1="360" y1="120" x2="360" y2="175" stroke="#555" stroke-width="1.5" marker-end="url(#a2)" />
  <text x="370" y="152" font-family="sans-serif" font-size="10" fill="#555">Calls convert()</text>

  <line x1="310" y1="240" x2="160" y2="305" stroke="#555" stroke-width="1.5" marker-end="url(#a2)" />
  <text x="200" y="270" font-family="sans-serif" font-size="10" fill="#555">Creates</text>

  <line x1="400" y1="240" x2="400" y2="305" stroke="#555" stroke-width="1.5" marker-end="url(#a2)" />
  <text x="410" y="278" font-family="sans-serif" font-size="10" fill="#555">Delegates to</text>

  <line x1="490" y1="337" x2="540" y2="337" stroke="#555" stroke-width="1.5" marker-end="url(#a2)" />
  <text x="515" y="330" font-family="sans-serif" font-size="10" fill="#555">Reads</text>

  <defs><marker id="a2" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#555" /></marker></defs>
</svg>

<p><code>cli.py</code> is the entry point. It instantiates <code>VdkConverter</code>, which owns the full read-transform-write pipeline. <code>VdkConverter</code> delegates payee resolution to <code>PayeeMapper</code>, which loads its rules from <code>payees.yaml</code>. <code>VdkTransaction</code> is the data object passed between all stages.</p>

<h3>Contained Building Blocks</h3>

<table>
  <thead><tr><th>Building Block</th><th>Responsibility</th></tr></thead>
  <tbody>
    <tr><td><code>cli.py</code></td><td>CLI entry point. Parses arguments, validates input path, instantiates converter, handles exit codes.</td></tr>
    <tr><td><code>VdkConverter</code></td><td>Orchestrates the read &rarr; map &rarr; write pipeline. Owns the list of bad records.</td></tr>
    <tr><td><code>VdkTransaction</code></td><td>Data transfer object. Splits a single amount into inflow/outflow on construction.</td></tr>
    <tr><td><code>PayeeMapper</code></td><td>Loads YAML config. Resolves a payee name from a memo via case-insensitive substring match.</td></tr>
  </tbody>
</table>

<h3>cli.py (Black Box)</h3>

<p>Purpose: CLI entry point that wires user input to the converter.</p>

<pre><code>python -m vdk_converter [input_csv] [-o OUTPUT_DIR] [-c CONFIG]</code></pre>

<table>
  <thead><tr><th>Argument</th><th>Required</th><th>Default</th><th>Description</th></tr></thead>
  <tbody>
    <tr><td><code>input_csv</code></td><td>No</td><td><code>~/Downloads/vdk.csv</code></td><td>Path to the VDK bank CSV export file.</td></tr>
    <tr><td><code>-o</code>, <code>--output-dir</code></td><td>No</td><td>Same directory as input</td><td>Directory where the converted CSV is written.</td></tr>
    <tr><td><code>-c</code>, <code>--config</code></td><td>No</td><td><code>config/payees.yaml</code></td><td>Path to the payee mapping YAML configuration.</td></tr>
  </tbody>
</table>

<p>Output file naming: <code>{YYYY-MM-DD_HH-MM}-vdk-converted.csv</code>. Exit codes: <code>0</code> on success, <code>1</code> on any error.</p>

<h3>converter.py &mdash; VdkConverter (Black Box)</h3>

<p>Purpose: Orchestrates the full conversion pipeline.</p>

<ul>
  <li><code>read_vdk_csv(csv_path)</code> &mdash; Opens the file with <code>windows-1252</code> encoding, skips 14 metadata lines, parses rows with semicolon-delimited <code>csv.DictReader</code>. Converts Dutch-format amounts to <code>Decimal</code>. Collects unparseable rows in <code>self.bad_records</code>.</li>
  <li><code>apply_payee_mappings(transactions)</code> &mdash; Iterates all transactions and replaces each payee via <code>PayeeMapper.map_payee()</code>. Modifies transactions in place.</li>
  <li><code>write_converted_csv(transactions, output_path)</code> &mdash; Writes semicolon-delimited CSV with columns <code>Date</code>, <code>Payee</code>, <code>Memo</code>, <code>Inflow</code>, <code>Outflow</code>. Formats amounts back to comma-as-decimal.</li>
  <li><code>convert(input_csv, output_dir)</code> &mdash; Runs the full pipeline. Returns the output file path on success, <code>None</code> if bad records exist.</li>
</ul>

<h3>payee_mapper.py &mdash; PayeeMapper (Black Box)</h3>

<p>Purpose: Resolves payee names from transaction memos using YAML-configured patterns.</p>

<ul>
  <li><code>_load_config(config_path)</code> &mdash; Reads the YAML file. Falls back to empty mappings if the file does not exist.</li>
  <li><code>map_payee(existing_payee, memo)</code> &mdash; Returns <code>existing_payee</code> if present. Otherwise performs a case-insensitive substring search of <code>memo</code> against all configured patterns. Returns the first matching payee name (question marks stripped), or <code>None</code>.</li>
</ul>

<h3>models.py &mdash; VdkTransaction (Black Box)</h3>

<p>Purpose: Data transfer object for a single bank transaction.</p>

<table>
  <thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead>
  <tbody>
    <tr><td><code>date</code></td><td><code>str</code></td><td>Transaction date as it appears in the VDK export.</td></tr>
    <tr><td><code>payee</code></td><td><code>Optional[str]</code></td><td>Counterparty name. From CSV or via payee mapping.</td></tr>
    <tr><td><code>memo</code></td><td><code>Optional[str]</code></td><td>Transaction description from the bank statement.</td></tr>
    <tr><td><code>amount</code></td><td><code>Decimal</code></td><td>Transaction amount. Negative = outgoing.</td></tr>
    <tr><td><code>inflow</code></td><td><code>Decimal</code></td><td>Computed. Equals <code>amount</code> when positive, otherwise <code>0</code>.</td></tr>
    <tr><td><code>outflow</code></td><td><code>Decimal</code></td><td>Computed. Equals <code>-amount</code> when negative, otherwise <code>0</code>.</td></tr>
  </tbody>
</table>

<!-- ========== 6. RUNTIME VIEW ========== -->
<h2 id="s6">6. Runtime View</h2>

<h3>Scenario: Successful Conversion</h3>
<ol>
  <li>User runs the CLI with a path to a VDK CSV export.</li>
  <li><code>cli.py</code> validates the input path and instantiates <code>VdkConverter</code> with the payee config path.</li>
  <li><code>VdkConverter.read_vdk_csv()</code> opens the file with <code>windows-1252</code> encoding, skips the 14-line bank header, and parses each data row into a <code>VdkTransaction</code>. Dutch number formatting is converted to <code>Decimal</code>. The <code>__post_init__</code> hook splits the amount into <code>inflow</code>/<code>outflow</code>.</li>
  <li><code>VdkConverter.apply_payee_mappings()</code> passes each transaction's payee and memo to <code>PayeeMapper.map_payee()</code>. Transactions with an empty payee get a payee assigned if the memo matches a pattern from <code>payees.yaml</code>.</li>
  <li><code>VdkConverter.write_converted_csv()</code> writes all transactions to a new semicolon-delimited CSV.</li>
  <li>The CLI prints the output file path and exits with code 0.</li>
</ol>

<h3>Scenario: Bad Records in Input</h3>
<p>If any row fails to parse during <code>read_vdk_csv()</code>, it is added to <code>self.bad_records</code>. When bad records exist, <code>convert()</code> prints the first five errors and returns <code>None</code>. The CLI exits with code 1. No output file is written.</p>

<!-- ========== 7. DEPLOYMENT VIEW ========== -->
<h2 id="s7">7. Deployment View</h2>

<h3>Infrastructure Level 1</h3>

<p>The converter runs locally on the user's machine. No server, container, or network infrastructure is involved.</p>

<table>
  <thead><tr><th>Component</th><th>Location</th></tr></thead>
  <tbody>
    <tr><td>Python package</td><td>Installed locally via pip or run directly.</td></tr>
    <tr><td><code>config/payees.yaml</code></td><td>Project directory (path overridable via <code>-c</code> flag).</td></tr>
    <tr><td>Input CSV</td><td>Downloaded from VDK online banking (default: <code>~/Downloads/vdk.csv</code>).</td></tr>
    <tr><td>Output CSV</td><td>Written to the same directory as input (overridable via <code>-o</code> flag).</td></tr>
  </tbody>
</table>

<!-- ========== 8. CROSS-CUTTING CONCEPTS ========== -->
<h2 id="s8">8. Cross-cutting Concepts</h2>

<h3>Character Encoding</h3>
<p>VDK exports use <code>windows-1252</code>. The converter reads with this encoding and writes output as UTF-8. These encodings are hardcoded in <code>read_vdk_csv()</code> and <code>write_converted_csv()</code>.</p>

<h3>Number Format Conversion</h3>
<p>Dutch number formatting uses dots as thousands separators and commas as decimal separators (<code>1.234,56</code>). The converter strips dots, replaces commas with dots, then parses to <code>Decimal</code>. On output, the reverse is applied: dots are replaced with commas.</p>

<h3>Payee Configuration</h3>
<p><code>config/payees.yaml</code> contains a list under the <code>payees</code> key. Each entry has a <code>pattern</code> (substring to match in memo, case-insensitive) and a <code>name</code> (payee to assign).</p>

<pre><code>payees:
  - pattern: "colruyt"
    name: "Colruyt"
  - pattern: "netflix"
    name: "Netflix"</code></pre>

<p>Matching is first-match-wins: patterns are evaluated in order, and the first match ends the search for that transaction.</p>

<!-- ========== 9. ARCHITECTURE DECISIONS ========== -->
<h2 id="s9">9. Architecture Decisions</h2>

<table>
  <thead><tr><th>Decision</th><th>Alternatives Considered</th><th>Reason</th></tr></thead>
  <tbody>
    <tr>
      <td>Use <code>Decimal</code> for amounts</td>
      <td><code>float</code>, integer cents</td>
      <td><code>Decimal</code> preserves exact values during conversion without requiring manual scaling.</td>
    </tr>
    <tr>
      <td>Substring matching for payees</td>
      <td>Regex, fuzzy matching</td>
      <td>Bank memos contain predictable merchant names. Substring search is sufficient and easy to configure.</td>
    </tr>
    <tr>
      <td>Skip first 14 lines of input</td>
      <td>Auto-detect header boundary</td>
      <td>VDK export format is fixed. A hardcoded skip count is simpler than heuristic detection.</td>
    </tr>
    <tr>
      <td>Abort on bad records</td>
      <td>Skip bad rows and continue</td>
      <td>Silently skipping rows risks missing transactions in financial data. Failing fast forces the user to inspect the input.</td>
    </tr>
  </tbody>
</table>

<!-- ========== 10. QUALITY REQUIREMENTS ========== -->
<h2 id="s10">10. Quality Requirements</h2>

<h3>Quality Requirements Overview</h3>

<table>
  <thead><tr><th>Quality Goal</th><th>Scenario</th><th>Measure</th></tr></thead>
  <tbody>
    <tr>
      <td>Correctness</td>
      <td>A VDK export with amounts like <code>-1.234,56</code> is converted.</td>
      <td>The output contains <code>1234,56</code> in the Outflow column with zero precision loss.</td>
    </tr>
    <tr>
      <td>Usability</td>
      <td>User runs the CLI with no arguments after placing <code>vdk.csv</code> in <code>~/Downloads/</code>.</td>
      <td>The converter produces a timestamped output file in <code>~/Downloads/</code> without additional configuration.</td>
    </tr>
    <tr>
      <td>Extensibility</td>
      <td>A new merchant appears in bank statements.</td>
      <td>The user adds one entry to <code>payees.yaml</code>. No code change or redeployment is needed.</td>
    </tr>
  </tbody>
</table>

<!-- ========== 11. RISKS AND TECHNICAL DEBTS ========== -->
<h2 id="s11">11. Risks and Technical Debts</h2>

<table>
  <thead><tr><th>Risk / Debt</th><th>Impact</th><th>Mitigation</th></tr></thead>
  <tbody>
    <tr>
      <td>Hardcoded 14-line skip</td>
      <td>If VDK changes their export header length, parsing breaks.</td>
      <td>The skip count is isolated in <code>read_vdk_csv()</code>. A single-line change fixes it.</td>
    </tr>
    <tr>
      <td>First-match payee mapping</td>
      <td>Overlapping patterns (e.g. "net" matching before "netflix") produce wrong results depending on rule order.</td>
      <td>Place more specific patterns before generic ones in <code>payees.yaml</code>.</td>
    </tr>
    <tr>
      <td><code>convert()</code> return type inconsistency</td>
      <td>Returns <code>str</code> on success but <code>None, None</code> (a tuple) on failure, while <code>cli.py</code> expects a single value.</td>
      <td>Standardize the return type to always return a single value or raise an exception.</td>
    </tr>
  </tbody>
</table>

<!-- ========== 12. GLOSSARY ========== -->
<h2 id="s12">12. Glossary</h2>

<table>
  <thead><tr><th>Term</th><th>Definition</th></tr></thead>
  <tbody>
    <tr><td>VDK</td><td>A Belgian bank (now part of KBC group) whose online banking exports CSV statements.</td></tr>
    <tr><td>YNAB</td><td>"You Need A Budget" &mdash; a personal budgeting application that imports CSV files with Date/Payee/Memo/Inflow/Outflow columns.</td></tr>
    <tr><td>Inflow</td><td>Money received (positive transaction amount).</td></tr>
    <tr><td>Outflow</td><td>Money spent (negative transaction amount, stored as a positive number in the output).</td></tr>
    <tr><td>Payee mapping</td><td>The process of assigning a human-readable counterparty name to a transaction based on its memo text.</td></tr>
  </tbody>
</table>

<footer>
  Generated on 2026-02-03. Structure follows the <a href="https://arc42.org">arc42</a> template (v9.0). Architecture diagrams use the <a href="https://c4model.com">C4 model</a>.
</footer>

</main>
</body>
</html>
